name: Deploy to Azure Static Web Apps

on:
  workflow_dispatch:
  push:
    branches:
      - actions-*
      - prod-*

jobs:
  build:

    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [16.x]
        # languages: [english, italian, chinese, portuguese, espanol]
        languages: [italian]

    steps:
    - name: Checkout source code
      uses: actions/checkout@v2

    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v2
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'

    - name: Install dependencies
      run: npm ci
    
    - name: Build the source code
      run: npm run build
      env:
        NODE_ENV: production
        BUILD_LANG: ${{ matrix.languages }}

        LOCAL_GHOST_API_URL: ${{ secrets.LOCAL_GHOST_API_URL }}
        LOCAL_GHOST_API_VERSION: ${{ secrets.LOCAL_GHOST_API_VERSION }}
        LOCAL_GHOST_CONTENT_API_KEY: ${{ secrets.LOCAL_GHOST_CONTENT_API_KEY }}
        
        ALGOLIA_API_KEY: ${{ secrets.ALGOLIA_API_KEY }}
        ALGOLIA_APP_ID: ${{ secrets.ALGOLIA_APP_ID }}
        
        CHINESE_GHOST_API_URL: ${{ secrets.CHINESE_GHOST_API_URL }}
        CHINESE_GHOST_API_VERSION: ${{ secrets.CHINESE_GHOST_API_VERSION }}
        CHINESE_GHOST_CONTENT_API_KEY: ${{ secrets.CHINESE_GHOST_CONTENT_API_KEY }}
        
        ENGLISH_GHOST_API_URL: ${{ secrets.ENGLISH_GHOST_API_URL }}
        ENGLISH_GHOST_API_VERSION: ${{ secrets.ENGLISH_GHOST_API_VERSION }}
        ENGLISH_GHOST_CONTENT_API_KEY: ${{ secrets.ENGLISH_GHOST_CONTENT_API_KEY }}
        
        ESPANOL_GHOST_API_URL: ${{ secrets.ESPANOL_GHOST_API_URL }}
        ESPANOL_GHOST_API_VERSION: ${{ secrets.ESPANOL_GHOST_API_VERSION }}
        ESPANOL_GHOST_CONTENT_API_KEY: ${{ secrets.ESPANOL_GHOST_CONTENT_API_KEY }}
        
        ITALIAN_GHOST_API_URL: ${{ secrets.ITALIAN_GHOST_API_URL }}
        ITALIAN_GHOST_API_VERSION: ${{ secrets.ITALIAN_GHOST_API_VERSION }}
        ITALIAN_GHOST_CONTENT_API_KEY: ${{ secrets.ITALIAN_GHOST_CONTENT_API_KEY }}
        
        PORTUGUESE_GHOST_API_URL: ${{ secrets.PORTUGUESE_GHOST_API_URL }}
        PORTUGUESE_GHOST_API_VERSION: ${{ secrets.PORTUGUESE_GHOST_API_VERSION }}
        PORTUGUESE_GHOST_CONTENT_API_KEY: ${{ secrets.PORTUGUESE_GHOST_CONTENT_API_KEY }}

        POSTS_PER_PAGE: ${{ secrets.POSTS_PER_PAGE }}
        SITE_DOMAIN: freecodecamp.org
        LOCALE_FOR_UI: ${{ matrix.languages }}
        LOCALE_FOR_GHOST: ${{ matrix.languages }}

